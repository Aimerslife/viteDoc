<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ™ºèƒ½åˆçº¦å¼€å‘ | Clark Cui</title>
    <meta name="description" content="æ™ºèƒ½åˆçº¦">
    <link rel="stylesheet" href="/assets/style.0b97b2d7.css">
    <link rel="modulepreload" href="/assets/Home.bdf9aa60.js">
    <link rel="modulepreload" href="/assets/app.10064a06.js">
    <link rel="modulepreload" href="/assets/posts_æ™ºèƒ½åˆçº¦å¼€å‘.md.48e85489.lean.js">
    
    <link rel="icon" type="image/jpeg" href="/avator.jpg">
  <meta name="author" content="Clark Cui">
  <meta property="og:title" content="Home">
  <meta property="og:description" content="Home of Clark Cui">
  <meta name="twitter:title" content="æ™ºèƒ½åˆçº¦å¼€å‘ | Clark Cui">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><div class="no-sidebar theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Clark Cui, back to home" data-v-40587210 data-v-016a8bd8><img class="logo" src="/tea.svg" alt="Logo" data-v-016a8bd8> Clark Cui</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>ğŸ¡Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/tags" data-v-49fe041d>ğŸ”–Tags <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/archives" data-v-49fe041d>ğŸ“ƒArchives <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="toggleTheme" data-v-f68cd400><div class="light" data-v-f68cd400>ğŸ”†</div></div><!--]--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>ğŸ¡Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/tags" data-v-49fe041d>ğŸ”–Tags <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/archives" data-v-49fe041d>ğŸ“ƒArchives <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--[--><!----><!--]--><!--[--><!--[--><h1 class="title" data-v-524a1c9d>æ™ºèƒ½åˆçº¦å¼€å‘</h1><div class="date" data-v-524a1c9d>ğŸ•’ lastUpdated: an hour ago</div><!--]--><div class="category" data-v-323418c7><ul data-v-323418c7><!--[--><li class="header" data-v-323418c7><a href="#ä»£ç åœ°å€" class="header-h1" data-v-323418c7>ä»£ç åœ°å€</a><!----></li><li class="header" data-v-323418c7><a href="#ä»¥å¤ªåŠå®¢æˆ·ç«¯" class="header-h1" data-v-323418c7>ä»¥å¤ªåŠå®¢æˆ·ç«¯</a><!----></li><li class="header" data-v-323418c7><!----><ul data-v-323418c7><li data-v-323418c7><a href="#evm" class="header-h2" data-v-323418c7>EVM</a></li></ul></li><li class="header" data-v-323418c7><!----><ul data-v-323418c7><li data-v-323418c7><a href="#ä»¥å¤ªåŠå®¢æˆ·ç«¯-1" class="header-h2" data-v-323418c7>ä»¥å¤ªåŠå®¢æˆ·ç«¯</a></li></ul></li><li class="header" data-v-323418c7><a href="#è´¦æˆ·" class="header-h1" data-v-323418c7>è´¦æˆ·</a><!----></li><li class="header" data-v-323418c7><a href="#gas" class="header-h1" data-v-323418c7>Gas</a><!----></li><li class="header" data-v-323418c7><!----><ul data-v-323418c7><li data-v-323418c7><a href="#å•ä½" class="header-h2" data-v-323418c7>å•ä½</a></li></ul></li><li class="header" data-v-323418c7><a href="#ç½‘ç»œ" class="header-h1" data-v-323418c7>ç½‘ç»œ</a><!----></li><li class="header" data-v-323418c7><a href="#åˆçº¦çš„ç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•" class="header-h1" data-v-323418c7>åˆçº¦çš„ç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•</a><!----></li><li class="header" data-v-323418c7><!----><ul data-v-323418c7><li data-v-323418c7><a href="#_1-remix" class="header-h2" data-v-323418c7>1. Remix</a></li></ul></li><li class="header" data-v-323418c7><!----><ul data-v-323418c7><li data-v-323418c7><a href="#_2-truffle" class="header-h2" data-v-323418c7>2. Truffle</a></li></ul></li><li class="header" data-v-323418c7><!----><ul data-v-323418c7><li data-v-323418c7><a href="#_3-hardhat" class="header-h2" data-v-323418c7>3. Hardhat</a></li></ul></li><!--]--></ul></div><!--]--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h2 id="ä»£ç åœ°å€" tabindex="-1">ä»£ç åœ°å€ <a class="header-anchor" href="#ä»£ç åœ°å€" aria-hidden="true">#</a></h2><p><a href="https://github.com/xilibi2003/contract-training-code" target="_blank" rel="noopener noreferrer">dlsq</a></p><h2 id="ä»¥å¤ªåŠå®¢æˆ·ç«¯" tabindex="-1">ä»¥å¤ªåŠå®¢æˆ·ç«¯ <a class="header-anchor" href="#ä»¥å¤ªåŠå®¢æˆ·ç«¯" aria-hidden="true">#</a></h2><h3 id="evm" tabindex="-1">EVM <a class="header-anchor" href="#evm" aria-hidden="true">#</a></h3><p>æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿæœº</p><h3 id="ä»¥å¤ªåŠå®¢æˆ·ç«¯-1" tabindex="-1">ä»¥å¤ªåŠå®¢æˆ·ç«¯ <a class="header-anchor" href="#ä»¥å¤ªåŠå®¢æˆ·ç«¯-1" aria-hidden="true">#</a></h3><ol><li>å®šä¹‰ï¼šä¹Ÿå°±æ˜¯ EVM çš„è½½ä½“ï¼Œä¹Ÿå°±æ˜¯åŒºå—é“¾ç½‘ç»œä¸­çš„èŠ‚ç‚¹çš„ç¨‹åºï¼Œåªè¦ç¬¦åˆç½‘ç»œè§„èŒƒï¼Œä»»ä½•è¯­è¨€éƒ½å¯ä»¥å®ç°å®¢æˆ·ç«¯</li><li>å¸¸è§çš„å®¢æˆ·ç«¯ï¼šGeth(Go å®ç°)ã€OpenEthereum(Rust å®ç°)ï¼Œé€šè¿‡ RPC æä¾›æœåŠ¡</li></ol><h2 id="è´¦æˆ·" tabindex="-1">è´¦æˆ· <a class="header-anchor" href="#è´¦æˆ·" aria-hidden="true">#</a></h2><p>æœ¬è´¨éƒ½æ˜¯ä¸€ä¸ª 20 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„åœ°å€</p><ol><li><p>å¤–éƒ¨è´¦æˆ·ï¼ˆEOAï¼‰ï¼šç”±ç§é’¥æ§åˆ¶ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„åœ°å€ï¼‰</p></li><li><p>åˆçº¦è´¦æˆ·ï¼šä»£ç æ§åˆ¶ï¼ˆæ¯”å¦‚åˆçº¦ä»£ç çš„éƒ¨ç½²åœ°å€ï¼‰</p></li></ol><blockquote><p>æ³¨æ„ï¼šäº¤æ˜“åªèƒ½ä»å¤–éƒ¨è´¦å·å‘å‡ºï¼Œåˆçº¦åªèƒ½è¢«åŠ¨æ‰§è¡Œã€‚åˆçº¦ä¹‹é—´çš„äº¤äº’ç§°ä¸ºæ¶ˆæ¯ï¼Œæ‰€æœ‰çš„ gas éƒ½ç”±å¤–éƒ¨è´¦å·æ”¯ä»˜</p></blockquote><h2 id="gas" tabindex="-1">Gas <a class="header-anchor" href="#gas" aria-hidden="true">#</a></h2><p>GAS æ˜¯ä¸€ä¸ªå·¥ä½œé‡å•ä½ï¼Œå¤æ‚åº¦è¶Šå¤§ï¼Œæ‰€éœ€ gas è¶Šå¤šã€‚è´¹ç”¨=gas æ•°é‡*gas å•ä»·ï¼ˆä»¥å¤ªå¸è®¡ä»· gweiï¼‰</p><h3 id="å•ä½" tabindex="-1">å•ä½ <a class="header-anchor" href="#å•ä½" aria-hidden="true">#</a></h3><ul><li>æœ€å°å•ä½ï¼šWei</li><li>10^9 Wei = 1 Gwei</li><li>10^12 Wei = 1 Szabo</li><li>10^15 Wei = 1 Finney</li><li>10^18 Wei = 1 Ether</li></ul><h2 id="ç½‘ç»œ" tabindex="-1">ç½‘ç»œ <a class="header-anchor" href="#ç½‘ç»œ" aria-hidden="true">#</a></h2><ol><li><a href="https://cn.etherscan.com/" target="_blank" rel="noopener noreferrer">ä¸»ç½‘ï¼ˆä»·å€¼ç½‘ç»œï¼‰</a></li><li><a href="https://goerli.etherscan.io/" target="_blank" rel="noopener noreferrer">æµ‹è¯•ç½‘</a></li><li>å¼€å‘æ¨¡æ‹Ÿç½‘ï¼ˆæœ¬åœ°ç¯å¢ƒï¼Œä¸€èˆ¬å°±æ˜¯å€ŸåŠ©å·¥å…·èµ·è™šæ‹Ÿæœºï¼‰</li></ol><h2 id="åˆçº¦çš„ç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•" tabindex="-1">åˆçº¦çš„ç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯• <a class="header-anchor" href="#åˆçº¦çš„ç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•" aria-hidden="true">#</a></h2><h3 id="_1-remix" tabindex="-1">1. Remix <a class="header-anchor" href="#_1-remix" aria-hidden="true">#</a></h3><p><a href="https://remix.ethereum.org/" target="_blank" rel="noopener noreferrer">é“¾æ¥</a></p><p>åœ¨contractsé‡Œæ·»åŠ Counter.sol</p><div class="language-sol"><pre><code><span class="token comment">// SPDX-License-Identifier:  MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Counter</span><span class="token punctuation">{</span>
    <span class="token builtin">uint</span> <span class="token keyword">public</span> counter<span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
        counter<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç¼–è¾‘å™¨å·¦ä¾§é¢æ¿æœ‰æ–‡ä»¶å¤¹åŒºåŸŸã€æœç´¢åŒºåŸŸã€ç¼–è¯‘åŒºåŸŸã€éƒ¨ç½²åŒºåŸŸã€‚</p><p>ç¼–è¯‘åŒºåŸŸå¯é€‰ç¼–è¯‘å™¨ç‰ˆæœ¬ã€‚</p><p>éƒ¨ç½²åŒºåŸŸå¯é€‰éƒ¨ç½²é“¾ï¼ŒæˆåŠŸåä¼šæ˜¾ç¤ºéƒ¨ç½²åœ°å€ã€‚éƒ¨ç½²åˆçº¦ä¹Ÿæ˜¯ä¸€ç¬”äº¤æ˜“ï¼Œéœ€è¦åœ¨é’±åŒ…ç¡®è®¤ï¼Œä¹Ÿéœ€è¦gasè´¹ã€‚éƒ¨ç½²æˆåŠŸåä¼šæ˜¾ç¤ºäº¤äº’é¢æ¿ï¼Œæ©™è‰²æ˜¯è§¦å‘äº¤æ˜“ï¼Œè“è‰²ä»…è¯»å–ã€‚ç‚¹å‡»æ©™è‰²è§¦å‘äº¤æ˜“ï¼Œéœ€è¦é’±åŒ…ç¡®è®¤ï¼Œéœ€è¦gasè´¹ã€‚ç‚¹å‡»è“è‰²è¯»å°±ä¸éœ€è¦ã€‚</p><p>å®é™…æ“ä½œï¼šenvironment é€‰æ‹© injected web3ï¼Œè¿™é‡Œè¿æ¥ metamusk é’±åŒ…ï¼Œé’±åŒ…å•¥ç½‘ç»œï¼Œå°±æ˜¯å•¥ç½‘ç»œã€‚æ¨èç”¨ goerliï¼ˆeth æµ‹è¯•ç½‘ï¼‰,å»<a href="https://goerlifaucet.com/" target="_blank" rel="noopener noreferrer">goerli faucet</a>ç”³è¯·ä¸€ç‚¹æµ‹è¯•å¸å³å¯ã€‚éƒ¨ç½²å‰ä¼šè¿æ¥é’±åŒ…ï¼Œç„¶åå°±æ˜¯ç”¨è´¦å·éƒ¨ç½²ä¸Šå»,éƒ¨ç½²å®Œåå¯ä»¥å»<a href="https://goerli.etherscan.io/" target="_blank" rel="noopener noreferrer">æµ‹è¯•é“¾æŸ¥çŠ¶æ€</a>ã€‚</p><p>éƒ¨ç½²æˆåŠŸåï¼Œç‚¹ä¸¤æ¬¡æ©™è‰²è§¦å‘äº¤æ˜“ï¼Œå†ç‚¹è“è‰²å¯ä»¥è¯»åˆ°æ­¤æ—¶counterå€¼çš„çŠ¶æ€ï¼Œæ§åˆ¶å°æ‰“å°ï¼š</p><div class="language-shell"><pre><code><span class="token punctuation">{</span>
	<span class="token string">&quot;0&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;uint256: 2&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ³¨æ„ remix ä¸­çš„ environment å¦‚æœæ˜¯é»˜è®¤çš„ï¼Œé‚£å°±æ˜¯è™šæ‹Ÿç½‘ç»œï¼Œåœ¨åŒºå—é“¾æµè§ˆå™¨æ˜¯æŸ¥ä¸åˆ°çš„ï¼Œè€Œä¸”ä¸éœ€è¦é’±åŒ…éªŒè¯ï¼Œä¹Ÿä¸éœ€è¦gasè´¹</p></blockquote><h3 id="_2-truffle" tabindex="-1">2. Truffle <a class="header-anchor" href="#_2-truffle" aria-hidden="true">#</a></h3><p>Truffle:ç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•åˆçº¦çš„ä¸€æ•´å¥—å¼€å‘å·¥å…·</p><p>ganacheæ˜¯å¼€å‘åŒºå—é“¾ï¼Œæä¾›æœ¬åœ°æ¨¡æ‹Ÿçš„é“¾ä¸Šç¯å¢ƒ</p><p><a href="https://trufflesuite.com/docs/truffle/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://learnblockchain.cn/docs/truffle/" target="_blank" rel="noopener noreferrer">ä¸­æ–‡æ–‡æ¡£</a></p><p><a href="https://github.com/clark-cui/truffle-demo" target="_blank" rel="noopener noreferrer">æˆ‘çš„ä»£ç </a></p><div class="language-shell"><pre><code>Truffle å®‰è£…  <span class="token function">npm</span> <span class="token function">install</span> -g truffle
åˆ›å»ºå·¥ç¨‹ truffle initæˆ–è€…truffle unbox metacoin<span class="token punctuation">(</span>æˆ‘ç”¨çš„ç¬¬äºŒä¸ªï¼Œç›¸å½“äºä½¿ç”¨metacoinè¿™ä¸ªæ¨¡ç‰ˆï¼Œæ³¨æ„éœ€è¦æ‰‹åŠ¨mkdirä¸€ä¸ªfolderï¼Œå†åœ¨é‡Œé¢æ‰§è¡Œåˆ›å»ºï¼Œæ³¨æ„é…ç½®proxy<span class="token punctuation">)</span>
</code></pre></div><p>truffleå·¥ç¨‹åŒ…å«</p><ul><li>contracts:æ™ºèƒ½åˆçº¦ç›®å½•</li><li>migrations:è¿ç§»æ–‡ä»¶ï¼Œç”¨æ¥æŒ‡ç¤ºå¦‚ä½•éƒ¨ç½²æ™ºèƒ½åˆçº¦</li><li>test:æ™ºèƒ½åˆçº¦æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶å¤¹</li><li>truffle-config.js:é…ç½®æ–‡ä»¶ï¼Œé…ç½®truffleè¿æ¥çš„ç½‘ç»œåŠç¼–è¯‘é€‰é¡¹</li><li>build:ç¼–è¯‘ç»“æœç›®å½•</li></ul><p>æ”¹é€ ä¸‹folder</p><ol><li><p>åˆ é™¤contractsã€migrationsã€testä¸‹çš„æ–‡ä»¶</p></li><li><p>contractsé‡Œæ·»åŠ Counter.sol</p><div class="language-solidity"><pre><code><span class="token comment">// SPDX-License-Identifier:  MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Counter</span><span class="token punctuation">{</span>
    <span class="token builtin">uint</span> <span class="token keyword">public</span> counter<span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
        counter<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="åˆçº¦ç¼–è¯‘" tabindex="-1">åˆçº¦ç¼–è¯‘ <a class="header-anchor" href="#åˆçº¦ç¼–è¯‘" aria-hidden="true">#</a></h4><div class="language-shel"><pre><code>//ä½¿ç”¨å‘½ä»¤
truffle compile
</code></pre></div><p>åœ¨é‚£ä¹‹å‰éœ€è¦é…ç½®truffle-config.jsï¼Œä¸é…ç½®å°±æ˜¯é»˜è®¤çš„0.5.16ç‰ˆæœ¬</p><div class="language-js"><pre><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  compilers<span class="token operator">:</span><span class="token punctuation">{</span>
    solc<span class="token operator">:</span><span class="token punctuation">{</span>
      version<span class="token operator">:</span><span class="token string">&quot;0.8.9&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç¼–è¯‘å®Œæˆä¼šè¾“å‡ºåœ¨buildç›®å½•,åŒæ—¶ä¹Ÿä¼šåœ¨å‘½ä»¤è¡Œè¾“å‡ºç¼–è¯‘ä½¿ç”¨çš„ç¼–è¯‘å™¨</p><div class="language-shell"><pre><code><span class="token operator">&gt;</span> Compiled successfully using:
   - solc: <span class="token number">0.8</span>.9+commit.e5eed63a.Emscripten.clang
</code></pre></div><p>ç¼–è¯‘ç»“æœæ˜¯jsonï¼ˆä¸åˆçº¦ä¸€ä¸€å¯¹åº”ï¼‰ï¼Œé‡Œé¢abiæ˜¯å’Œå‰ç«¯äº¤äº’çš„ï¼Œbytecodeå°±æ˜¯æœ€åéƒ¨ç½²åœ¨é“¾ä¸Šçš„ä¸œè¥¿</p><h4 id="æ¥ä¸‹æ¥æ˜¯åˆçº¦çš„éƒ¨ç½²" tabindex="-1">æ¥ä¸‹æ¥æ˜¯åˆçº¦çš„éƒ¨ç½² <a class="header-anchor" href="#æ¥ä¸‹æ¥æ˜¯åˆçº¦çš„éƒ¨ç½²" aria-hidden="true">#</a></h4><div class="language-shell"><pre><code>//ä½¿ç”¨å‘½ä»¤
truffle migrate
truffle migrate --network networkname //å¯ä»¥åœ¨åé¢åŠ networkå‚æ•°å’Œnetworkåå­—ï¼Œéƒ¨ç½²åˆ°æŒ‡å®šnetwork
</code></pre></div><p>åœ¨é‚£ä¹‹å‰ï¼Œéœ€è¦å…ˆå†™å¥½é…ç½®æ–‡ä»¶</p><ol><li><p>ç¼–å†™éƒ¨ç½²è„šæœ¬</p><p>migrationsé‡Œæ·»åŠ 1_counter.js</p><div class="language-js"><pre><code><span class="token keyword">const</span> Counter <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deployer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>éƒ¨ç½²åˆ°æœ¬åœ°èŠ‚ç‚¹ï¼ˆæˆ‘æ²¡æœ‰æï¼‰</p><ol><li><p>å…ˆå¯åŠ¨ä¸€ä¸ªæœåŠ¡æ¨¡æ‹Ÿé“¾ä¸Šç¯å¢ƒ<code>ganache-cli -p 7545</code>(ganacheæ˜¯å¼€å‘åŒºå—é“¾ï¼Œæä¾›æœ¬åœ°æ¨¡æ‹Ÿçš„é“¾ä¸Šç¯å¢ƒ)</p></li><li><p>ç„¶åæ·»åŠ devçš„network</p><div class="language-js"><pre><code><span class="token comment">//truffle-config.js developmentç½‘ç»œé…ç½®</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  networks<span class="token operator">:</span><span class="token punctuation">{</span>
    development<span class="token operator">:</span><span class="token punctuation">{</span>
      host<span class="token operator">:</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
      port<span class="token operator">:</span><span class="token number">7545</span><span class="token punctuation">,</span>
   		network_id<span class="token operator">:</span><span class="token string">&quot;*&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p><code>truffle migrate â€” network development</code>éƒ¨ç½²ï¼Œæœ¬åœ°éƒ¨ç½²ï¼Œä¸éœ€è¦éªŒè¯å’Œgasè´¹</p></li></ol></li><li><p>éƒ¨ç½²åˆ°é“¾ä¸Š</p><ol><li><p>éœ€è¦éƒ¨ç½²åˆ°é“¾ä¸Šçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥å…ˆå»<a href="https://infura.io/" target="_blank" rel="noopener noreferrer">infura.io</a>åˆ›å»ºä¸€ä¸ªprojectï¼Œç„¶åcopy project idï¼ˆé€‰æ‹©endpointsæ˜¯goerliï¼‰</p></li><li><p>å½“å‰ç›®å½•æ–°å»ºä¸¤ä¸ªéšè—æ–‡ä»¶ï¼Œ.api_keyå’Œ.mnemonicï¼Œ.gitignoreè¦æ·»åŠ è¿™ä¸¤é¡¹ï¼Œåˆ†åˆ«å­˜å‚¨ä¸Šä¸€æ­¥çš„idå’Œä½ çš„é’±åŒ…è´¦æˆ·åŠ©è®°è¯ï¼ˆä¸»è¦ä¸ºäº†é˜²æ­¢å¤–æ³„ï¼‰</p></li><li><p>åˆå§‹åŒ–npm ï¼Œæ·»åŠ truffle-hdwallet-provideråŒ…</p><div class="language-shell"><pre><code><span class="token function">npm</span> init
<span class="token function">npm</span> i truffle-hdwallet-provider -s
.gitignore æ·»åŠ node_modules
</code></pre></div></li><li><p>config.jsé‡Œçš„networké‡Œæ·»åŠ æ–°çš„network goerli</p><div class="language-js"><pre><code><span class="token keyword">const</span> HDWalletProvider <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;truffle-hdwallet-provider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> api_key <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;.api_key&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mnemonic <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;.mnemonic&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  networks<span class="token operator">:</span> <span class="token punctuation">{</span>
    goerli<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">provider</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HDWalletProvider</span><span class="token punctuation">(</span>mnemonic<span class="token punctuation">,</span> <span class="token string">&#39;https://goerli.infura.io/v3/&#39;</span> <span class="token operator">+</span> api_key<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      network_id<span class="token operator">:</span> <span class="token string">&#39;5&#39;</span><span class="token punctuation">,</span>
      gas<span class="token operator">:</span> <span class="token number">4465030</span><span class="token punctuation">,</span>
      gasPrice<span class="token operator">:</span> <span class="token number">10000000000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>æ‰§è¡Œ<code>truffle migrate â€” network goerli</code>éƒ¨ç½²åˆ°goerliï¼Œè¿™é‡Œä¼šæ¶ˆè€—gasè´¹ï¼Œä½†æ²¡æœ‰metamuskå¼¹çª—ç¡®è®¤çš„è¿‡ç¨‹ï¼Œå› ä¸ºæˆ‘è¾“å…¥äº†åŠ©è®°è¯ï¼Œä»–ç›´æ¥åœ¨é’±åŒ…æ‰£æ¬¾äº†</p><div class="language-shell"><pre><code>//å‘½ä»¤è¡Œè¾“å‡º
Compiling your contracts<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">&gt;</span> Everything is up to date, there is nothing to compile.


Migrations dry-run <span class="token punctuation">(</span>simulation<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">&gt;</span> Network name:    <span class="token string">&#39;goerli-fork&#39;</span>
<span class="token operator">&gt;</span> Network id:      <span class="token number">5</span>
<span class="token operator">&gt;</span> Block gas limit: <span class="token number">30000000</span> <span class="token punctuation">(</span>0x1c9c380<span class="token punctuation">)</span>


1_counter.js
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

   Deploying <span class="token string">&#39;Counter&#39;</span>
   -------------------
   <span class="token operator">&gt;</span> block number:        <span class="token number">6818292</span>
   <span class="token operator">&gt;</span> block timestamp:     <span class="token number">1651505825</span>
   <span class="token operator">&gt;</span> account:             0x736D76f4C2d4b4CCced0CCA92d3dF0F0e456F35D
   <span class="token operator">&gt;</span> balance:             <span class="token number">0.04813429249775099</span>
   <span class="token operator">&gt;</span> gas used:            <span class="token number">135269</span> <span class="token punctuation">(</span>0x21065<span class="token punctuation">)</span>
   <span class="token operator">&gt;</span> gas price:           <span class="token number">10</span> gwei
   <span class="token operator">&gt;</span> value sent:          <span class="token number">0</span> ETH
   <span class="token operator">&gt;</span> total cost:          <span class="token number">0.00135269</span> ETH

   -------------------------------------
   <span class="token operator">&gt;</span> Total cost:          <span class="token number">0.00135269</span> ETH

Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">&gt;</span> Total deployments:   <span class="token number">1</span>
<span class="token operator">&gt;</span> Final cost:          <span class="token number">0.00135269</span> ETH




Starting migrations<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token operator">&gt;</span> Network name:    <span class="token string">&#39;goerli&#39;</span>
<span class="token operator">&gt;</span> Network id:      <span class="token number">5</span>
<span class="token operator">&gt;</span> Block gas limit: <span class="token number">29970705</span> <span class="token punctuation">(</span>0x1c95111<span class="token punctuation">)</span>


1_counter.js
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

   Deploying <span class="token string">&#39;Counter&#39;</span>
   -------------------
   <span class="token operator">&gt;</span> transaction hash:    0x376710e125c35233b468bd232444acc2239c38e837aeecf9ef9de6762715eca8
   <span class="token operator">&gt;</span> Blocks: <span class="token number">0</span>            Seconds: <span class="token number">5</span>
   <span class="token operator">&gt;</span> contract address:    0xAc8dC14e7aC85556Bcc22c052FbB5Bc05D4E77D8
   <span class="token operator">&gt;</span> block number:        <span class="token number">6818298</span>
   <span class="token operator">&gt;</span> block timestamp:     <span class="token number">1651505843</span>
   <span class="token operator">&gt;</span> account:             0x736D76f4C2d4b4CCced0CCA92d3dF0F0e456F35D
   <span class="token operator">&gt;</span> balance:             <span class="token number">0.04813429249775099</span>
   <span class="token operator">&gt;</span> gas used:            <span class="token number">135269</span> <span class="token punctuation">(</span>0x21065<span class="token punctuation">)</span>
   <span class="token operator">&gt;</span> gas price:           <span class="token number">10</span> gwei
   <span class="token operator">&gt;</span> value sent:          <span class="token number">0</span> ETH
   <span class="token operator">&gt;</span> total cost:          <span class="token number">0.00135269</span> ETH

   <span class="token operator">&gt;</span> Saving artifacts
   -------------------------------------
   <span class="token operator">&gt;</span> Total cost:          <span class="token number">0.00135269</span> ETH

Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">&gt;</span> Total deployments:   <span class="token number">1</span>
<span class="token operator">&gt;</span> Final cost:          <span class="token number">0.00135269</span> ETH


</code></pre></div></li></ol></li></ol><h4 id="è¡¥å……å†…å®¹" tabindex="-1">è¡¥å……å†…å®¹ <a class="header-anchor" href="#è¡¥å……å†…å®¹" aria-hidden="true">#</a></h4><ol><li><p>Truffle consoleä½¿ç”¨ï¼ˆå¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°è°ƒç”¨åˆçº¦ï¼‰</p><p>å…ˆæŠŠåˆçº¦éƒ¨ç½²åˆ°development</p><p><code>truffle console --network development</code>å¼€å¯è°ƒç”¨æ¨¡å¼</p></li><li><p><a href="http://truffle-min.sh" target="_blank" rel="noopener noreferrer">truffle-min.sh</a>(å‹ç¼©artifactsæ–‡ä»¶)</p><p>æˆ‘ä»¬compileåï¼Œæ˜¯ä¼šåœ¨buildé‡Œè¾“å‡ºä¸€ä¸ªjsonï¼Œä½†æ˜¯è¿™ä¸ªjsonå¾ˆå¤§ï¼Œæ‰€ä»¥å¯ä»¥å€ŸåŠ©è¿™ä¸ªè„šæœ¬æ¥å¯¹è¿™ä¸ªjsonè¿›è¡Œå‹ç¼©ï¼Œå¯ä»¥ä»å‡ åƒè¡Œå‹ç¼©åˆ°å‡ åè¡Œï¼Œç„¶åæˆ‘ä»¬åç»­çš„å¼€å‘æœ‰å¼•ç”¨è¿™ä¸ªjsonçš„éœ€æ±‚çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¼•å…¥è¿™ä¸ªå‹ç¼©çš„json</p></li></ol><h3 id="_3-hardhat" tabindex="-1">3. Hardhat <a class="header-anchor" href="#_3-hardhat" aria-hidden="true">#</a></h3><p>Hardhat:ç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•å’Œè°ƒè¯•ä»¥å¤ªåŠåº”ç”¨çš„å¼€å‘ç¯å¢ƒï¼Œå›´ç»•taskï¼ˆä»»åŠ¡ï¼‰å’Œpluginsï¼ˆæ’ä»¶ï¼‰æ¦‚å¿µè®¾è®¡</p><p>åœ¨å‘½ä»¤è¡Œè¿è¡ŒHardhatæ—¶ï¼Œéƒ½æ˜¯åœ¨è¿è¡Œä»»åŠ¡ï¼Œä¾‹å¦‚ï¼šnpx hardhat compileå°±æ˜¯è¿è¡Œcompileä»»åŠ¡</p><p>Hardhat node:å¼€å‘åŒºå—é“¾ï¼Œæä¾›æœ¬åœ°æ¨¡æ‹Ÿçš„é“¾ä¸Šç¯å¢ƒ</p><p><a href="https://hardhat.org/getting-started/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>,<a href="https://learnblockchain.cn/docs/hardhat/getting-started/" target="_blank" rel="noopener noreferrer">ä¸­æ–‡æ–‡æ¡£</a></p><p><a href="https://github.com/NomicFoundation/hardhat-hackathon-boilerplate" target="_blank" rel="noopener noreferrer">å‚è€ƒä»£ç </a></p><p><a href="https://github.com/clark-cui/hardhat-demo" target="_blank" rel="noopener noreferrer">æˆ‘çš„ä»£ç </a></p><h4 id="åˆ›å»ºå·¥ç¨‹" tabindex="-1">åˆ›å»ºå·¥ç¨‹ <a class="header-anchor" href="#åˆ›å»ºå·¥ç¨‹" aria-hidden="true">#</a></h4><div class="language-shell"><pre><code><span class="token function">mkdir</span> hardhat-demo //åˆ›å»ºä¸€ä¸ªfolder
<span class="token builtin class-name">cd</span> hardhat-demo
<span class="token function">npm</span> init //åˆå§‹åŒ–npm
<span class="token function">npm</span> i -s hardhat //å½“å‰ç›®å½•ä¸‹å®‰è£…hardhat
npx hardhat //åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºé¡¹ç›®,å¯ä»¥é€‰basic-sample<span class="token punctuation">(</span>æ³¨æ„ï¼Œè¿™ä¸€æ­¥è¦å¼€å¯shell proxy<span class="token punctuation">)</span>
</code></pre></div><p>contractsé‡Œæ–°å»ºCounter.solï¼Œæ·»åŠ ä¸€ä¸‹å†…å®¹</p><div class="language-solidity"><pre><code><span class="token comment">// SPDX-License-Identifier:  MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;hardhat/console.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Counter</span><span class="token punctuation">{</span>
    <span class="token builtin">uint</span> <span class="token keyword">public</span> counter<span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
        counter<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;curr counter:&quot;</span><span class="token punctuation">,</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
        counter<span class="token operator">=</span>counter<span class="token operator">+</span>x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="åˆçº¦ç¼–è¯‘-1" tabindex="-1">åˆçº¦ç¼–è¯‘ <a class="header-anchor" href="#åˆçº¦ç¼–è¯‘-1" aria-hidden="true">#</a></h4><div class="language-js"><pre><code><span class="token comment">//å…ˆä¿®æ”¹hardhat.config.jsï¼Œè®¾ç½®ç¼–è¯‘å™¨ç‰ˆæœ¬</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  Solidity<span class="token operator">:</span><span class="token string">&quot;0.8.9&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">//ç„¶åå‘½ä»¤è¡Œè¾“å…¥</span>
npx hardhat compile 
</code></pre></div><h4 id="éƒ¨ç½²" tabindex="-1">éƒ¨ç½² <a class="header-anchor" href="#éƒ¨ç½²" aria-hidden="true">#</a></h4><ol><li><p>ç¼–å†™éƒ¨ç½²è„šæœ¬</p><div class="language-js"><pre><code><span class="token comment">//scripts/deploy_counter.js</span>
<span class="token keyword">const</span> hre <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hardhat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//await hre.run(&#39;compile&#39;);</span>
  <span class="token keyword">const</span> Counter <span class="token operator">=</span> <span class="token keyword">await</span> hre<span class="token punctuation">.</span>ethers<span class="token punctuation">.</span><span class="token function">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">await</span> Counter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//deployé‡Œçš„æ‹¬å·å¯ä»¥ä¼ å‚ï¼Œå…·ä½“çœ‹åˆçº¦é‡Œçš„construtoræœ‰æ²¡æœ‰å‚æ•°è€Œå®š</span>

  <span class="token keyword">await</span> counter<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Counter deployed to:&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>å¦‚æœæƒ³è¦ä¸€æ¬¡éƒ¨ç½²å¤šä¸ªåˆçº¦ï¼Œæ¯”å¦‚è¿™é‡Œæœ‰counterå’Œgreeteråˆçº¦ï¼Œé‚£ä¹ˆå¯ä»¥è¿™ä¹ˆå†™</p><div class="language-js"><pre><code><span class="token comment">//scripts/deploy.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> ethers <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hardhat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>deployer<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> ethers<span class="token punctuation">.</span><span class="token function">getSigners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Deploying contracts with the account: &#39;</span> <span class="token operator">+</span> deployer<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Deploy Greeter</span>
  <span class="token keyword">const</span> Greeter <span class="token operator">=</span> <span class="token keyword">await</span> ethers<span class="token punctuation">.</span><span class="token function">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Greeter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> greeter <span class="token operator">=</span> <span class="token keyword">await</span> Greeter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, Hardhat!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// Deploy Counter</span>
  <span class="token keyword">const</span> Counter <span class="token operator">=</span> <span class="token keyword">await</span> hre<span class="token punctuation">.</span>ethers<span class="token punctuation">.</span><span class="token function">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">await</span> Counter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// console.log</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Greeter deployed to:&quot;</span><span class="token punctuation">,</span> greeter<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Counter deployed to:&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ</p><p>å…ˆå¯åŠ¨ä¸€ä¸ªæœ¬åœ°ç½‘ç»œ<code>npx hardhat node</code>,ç„¶åå†æ ¹æ®ç«¯å£å€¼æ¥ä¿®æ”¹hardhat.config.jsï¼Œå¢åŠ ä»¥ä¸‹å†…å®¹</p><div class="language-js"><pre><code><span class="token comment">//hardhat.config.js</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  networks<span class="token operator">:</span><span class="token punctuation">{</span>
    development<span class="token operator">:</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span><span class="token string">&quot;http://127.0.0.1:8545&quot;</span><span class="token punctuation">,</span>
      chainId<span class="token operator">:</span><span class="token number">31337</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ‰§è¡Œéƒ¨ç½²<code>npx hardhat run scripts/deploy_xxx.js [--network ç½‘ç»œ]</code>ï¼Œè€Œè¿™é‡Œçš„è¯ï¼Œå°±æ˜¯æ‰§è¡Œ<code>npx hardhat run scripts/deploy_counter.js --network development</code></p></li><li><p>éƒ¨ç½²åˆ°é“¾ä¸Š</p><p>éœ€è¦éƒ¨ç½²åˆ°é“¾ä¸Šçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥å…ˆå»<a href="https://infura.io/" target="_blank" rel="noopener noreferrer">infura.io</a>åˆ›å»ºä¸€ä¸ªprojectï¼Œç„¶åcopy project idï¼ˆé€‰æ‹©endpointsæ˜¯goerliï¼‰</p><p>æœ¬åœ°æ·»åŠ .api_keyå’Œ.mnemonicï¼Œ.gitignoreæ·»åŠ è¿‡æ»¤è¿™ä¸¤é¡¹ï¼Œç„¶åä¿®æ”¹hardhat.config.js,å¢åŠ ä»¥ä¸‹å†…å®¹</p><div class="language-js"><pre><code><span class="token comment">//hardhat.config.js</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> api_key <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;.api_key&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mnemonic <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;.mnemonic&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  networks<span class="token operator">:</span><span class="token punctuation">{</span>
    goerli<span class="token operator">:</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://goerli.infura.io/v3/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>api_key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      accounts<span class="token operator">:</span><span class="token punctuation">{</span>
        mnemonic<span class="token operator">:</span>mnemonic<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><p>â€‹ æ‰§è¡Œéƒ¨ç½²<code>npx hardhat run scripts/deploy.js --network goerli</code></p><h4 id="æµ‹è¯•" tabindex="-1">æµ‹è¯• <a class="header-anchor" href="#æµ‹è¯•" aria-hidden="true">#</a></h4><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span>expect<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>ethers<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hardhat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;counter should be 0 when init , be added 1 after count be called, be added x after add be called with x&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Counter <span class="token operator">=</span> <span class="token keyword">await</span> ethers<span class="token punctuation">.</span><span class="token function">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> counterInstance <span class="token operator">=</span> <span class="token keyword">await</span> Counter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> counterInstance<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">await</span> counterInstance<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> setCountTx <span class="token operator">=</span> <span class="token keyword">await</span> counterInstance<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// wait until the transaction is mined</span>
    <span class="token keyword">await</span> setCountTx<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">await</span> counterInstance<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> addCountTx <span class="token operator">=</span> <span class="token keyword">await</span> counterInstance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> addCountTx<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">await</span> counterInstance<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>npx hardhat test</code>æ‰§è¡Œæµ‹è¯•</p><h4 id="å®æˆ˜" tabindex="-1">å®æˆ˜ <a class="header-anchor" href="#å®æˆ˜" aria-hidden="true">#</a></h4><ol><li><p>è°ƒè¯•åˆ©å™¨ï¼šconsole.log</p><div class="language-solidity"><pre><code><span class="token keyword">import</span> <span class="token string">&quot;hardhat/console.sol&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>çµæ´»å‚æ•°éƒ¨ç½²ï¼Œåˆ©ç”¨hardhatå¯ä»¥åœ¨ä»£ç ä¸­å¼•ç”¨(è¿™é‡Œå€¼çš„æ˜¯åˆçº¦åˆå§‹åŒ–çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯constructoréœ€è¦çš„å‚æ•°ï¼Œæ¯”å¦‚Greeteråˆçº¦ï¼Œè¿™é‡Œå¯ä»¥åœ¨éƒ¨ç½²è„šæœ¬é‡Œä¼ å…¥å‚æ•°ï¼Œæ¯”å¦‚deploy_greeter.jsæ‰€å†™ã€‚ä¹Ÿå¯ä»¥ç”¨nodejsçš„æ–¹å¼ï¼Œåœ¨å‘½ä»¤è¡Œä¼ å…¥å‚æ•°,ç„¶ååœ¨éƒ¨ç½²è„šæœ¬é‡Œå–å‡ºæ¥)</p><ol><li><div class="language-solidity"><pre><code><span class="token comment">// Counter.sol</span>
<span class="token comment">// SPDX-License-Identifier:  MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;hardhat/console.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Counter</span><span class="token punctuation">{</span>
    <span class="token builtin">uint</span> <span class="token keyword">public</span> counter<span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _counter<span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter <span class="token operator">=</span> _counter<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
        counter<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;curr counter:&quot;</span><span class="token punctuation">,</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
        counter<span class="token operator">=</span>counter<span class="token operator">+</span>x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// test_counter.js</span>
const <span class="token punctuation">{</span>expect<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;chai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const <span class="token punctuation">{</span>ethers<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;hardhat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;counter should be 0 when init , be added 1 after count be called, be added x after add be called with x&quot;</span><span class="token punctuation">,</span> async <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const Counter <span class="token operator">=</span> await ethers<span class="token punctuation">.</span><span class="token function">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    const counterInstance <span class="token operator">=</span> await Counter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    await counterInstance<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>await counterInstance<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    const setCountTx <span class="token operator">=</span> await counterInstance<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// wait until the transaction is mined</span>
    await setCountTx<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>await counterInstance<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    const addCountTx <span class="token operator">=</span> await counterInstance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    await addCountTx<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>await counterInstance<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//deploy_counter.js</span>
<span class="token comment">//å…¶ä½™ç›¸åŒï¼Œåªéœ€æ”¹ä¸‹é¢è¿™ä¸€å¥</span>
 const counter <span class="token operator">=</span> await Counter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></li><li><p>è®¾ç½®deployè„šæœ¬</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span>ethers<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hardhat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> params<span class="token operator">=</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">;</span>
<span class="token keyword">const</span> value<span class="token operator">=</span>params<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Counter deploy with value:&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//await hre.run(&#39;compile&#39;);</span>
  <span class="token keyword">const</span> Counter <span class="token operator">=</span> <span class="token keyword">await</span> ethers<span class="token punctuation">.</span><span class="token function">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">await</span> Counter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> counter<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Counter deployed to:&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div></li><li><p>æ‰§è¡Œnodeè„šæœ¬,å¹¶ä¼ é€’å‚æ•°</p><p>éœ€è¦ä¸¤ä¸ªå‘½ä»¤ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¾æ¬¡æ‰§è¡Œï¼Œ<a href="http://xn--4gqvdzgque2iqseq47a.sh" target="_blank" rel="noopener noreferrer">ä¹Ÿå¯ä»¥å†™æˆä¸€ä¸ª.sh</a>ï¼Œ<code>sh ./deploy_by_param.sh </code>æ‰§è¡Œè¿™ä¸ª.shå³å¯</p><div class="language-shell"><pre><code>// ./deploy_by_param.sh
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HARDHAT_NETWORK</span><span class="token operator">=</span><span class="token string">&#39;development&#39;</span> //è®¾ç½®networkçš„å€¼æ˜¯developmentï¼›è¿™å°±æ˜¯nodeæ‰§è¡Œhardhatè„šæœ¬é™„ç€hardhatå‚æ•°çš„æ–¹å¼+
node scripts/deploy_by_param.js <span class="token number">10</span> //åœ¨è¿™é‡Œä¼ å…¥åˆå§‹åŒ–å‚æ•°æ˜¯10
</code></pre></div></li></ol></li><li><p>ä»£ç æ‰å¹³ï¼š<code>npx hardhat flatten xxx.sol &gt; xxx.sol</code></p><p>æœ¬è´¨çš„æ„ä¹‰æ˜¯ï¼Œå½“ä¸€ä¸ªåˆçº¦çš„é‡Œé¢æœ‰importå¼•ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤æŠŠå¼•ç”¨çš„ä»£ç å’Œæœ¬èº«çš„ä»£ç æ”¾åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿çœ‹ï¼Œè¿™é‡Œçš„è¯å°±æ˜¯<code>npx hardhat flatten contracts/Counter.sol &gt;&gt;Counter.sol</code></p></li><li><p>ä»£ç éªŒè¯</p><p>å½“åˆçº¦éƒ¨ç½²åœ¨é“¾ä¸Šåï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤æ¥å¯¹ä»£ç è¿›è¡ŒéªŒè¯</p><div class="language-shell"><pre><code><span class="token number">1</span>.å…ˆå®‰è£… <span class="token function">npm</span> i hardhat-etherscan --dev
<span class="token number">2</span>.hardhat.config.jsé‡Œæ·»åŠ require<span class="token punctuation">(</span><span class="token string">&quot;@nomiclabs/hardhat-etherscan&quot;</span><span class="token punctuation">)</span>
<span class="token number">3</span>.æ·»åŠ scankey,const <span class="token assign-left variable">scankey</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{</span>scanKey<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">;</span> //å› ä¸ºè°ƒç”¨etherscançš„apiï¼Œæ‰€ä»¥éœ€è¦å»ä»–é‚£é‡Œç”³è¯·ä¸€ä¸ªkey, https://etherscan.io/,è¿™ä¸ªkeyæœ€å¥½ä¹Ÿç”¨éšè—æ–‡ä»¶ï¼Œä¸è¦æš´éœ²å‡ºå»
<span class="token number">4</span>.åœ¨é…ç½®é‡Œï¼Œnetworksçš„ä¸‹é¢ï¼Œæ·»åŠ åŒçº§é¡¹ etherscan:<span class="token punctuation">{</span>apiKey:scankey<span class="token punctuation">}</span>
<span class="token number">5</span>.å‘½ä»¤è¡Œæ‰§è¡Œnpx hardhat verify address --network xxx // addressæ˜¯åˆçº¦çš„éƒ¨ç½²åœ°å€ï¼Œxxxæ˜¯è¦éªŒè¯çš„ç½‘ç»œ
</code></pre></div></li><li><p>ABIå¯¼å‡º</p><p>å½“åˆçº¦éƒ¨ç½²åï¼Œéœ€è¦å¯¼å‡ºABIä¾›å‰ç«¯è°ƒç”¨ï¼Œé»˜è®¤çš„deployå°±ä¼šå¯¼å‡ºä¸€ä¸ªæ€»çš„jsoné‡Œé¢åŒ…æ‹¬abiï¼Œä¸è¿‡æ¯”è¾ƒå¤§è€Œå·²ï¼Œè¿™é‡Œæ˜¯ä»…å¯¼å‡ºabiçš„json</p><div class="language-shell"><pre><code><span class="token number">1</span>.å…ˆå®‰è£… <span class="token function">npm</span> i hardhat-abi-exporter --dev
<span class="token number">2</span>.hardhat.config.jsé‡Œæ·»åŠ require<span class="token punctuation">(</span><span class="token string">&quot;hardhat-abi-exporter&quot;</span><span class="token punctuation">)</span>
<span class="token number">3</span>.hardhat.config.jsé‡Œé…ç½®ä¸‹å¯¼å‡º,æ–°å»º./abiç›®å½•æ¥å­˜æ”¾
  abiExporter: <span class="token punctuation">{</span>
    path: <span class="token string">&#39;./abi&#39;</span>,
    runOnCompile: true,
    clear: true,
    flat: true,
    spacing: <span class="token number">2</span>,
    pretty: false,
  <span class="token punctuation">}</span>
<span class="token number">4</span>.npx hardhat export-abi
</code></pre></div></li><li><p>è‡ªå®šä¹‰Task</p><p>åœ¨hardhat.config.jsé‡Œå¯ä»¥å†™task,ç„¶åé€šè¿‡<code>npx hardhat taskName</code>å®Œæˆä¸€äº›æƒ³è¦åšçš„äº‹ï¼Œä¹Ÿå¯ä»¥åœ¨taskæ–‡ä»¶å¤¹é‡Œå†™ï¼Œç„¶ååœ¨hardhat.config.jsç”¨requireå¼•å…¥</p><div class="language-js"><pre><code><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;accounts&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Prints the list of accounts&quot;</span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">taskArgs<span class="token punctuation">,</span>hre</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> accounts <span class="token operator">=</span><span class="token keyword">await</span> hre<span class="token punctuation">.</span>ethers<span class="token punctuation">.</span><span class="token function">getSigners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> account <span class="token keyword">of</span> accounts<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//å‘½ä»¤è¡Œ npx hardhat accountsæ‰§è¡Œ</span>
</code></pre></div></li><li><p>ä¹¦å†™è„šæœ¬å»è°ƒç”¨åˆçº¦ï¼Œå®ç°å‰ç«¯ä¸åˆçº¦çš„äº¤äº’</p><ol><li><p>å‰ç«¯æƒ³è¦è°ƒç”¨åˆçº¦ï¼Œé‚£å°±å¾—çŸ¥é“åˆçº¦çš„åœ°å€å’Œabiï¼Œä¹‹å‰æœ‰ç”¨npmå¤„ç†äº†abiçš„å•ç‹¬å¯¼å‡ºï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¤„ç†åˆçº¦çš„åœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æ”¹é€ ä¸‹deployè„šæœ¬ï¼Œè®©å®ƒè‡ªåŠ¨ä¿å­˜åœ°å€å’Œabiåˆ°ä¸€ä¸ªdataçš„ç›®å½•ä¸‹</p><div class="language-js"><pre><code><span class="token comment">// scripts/deploy_counter.js</span>
<span class="token keyword">const</span> hre <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hardhat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//await hre.run(&#39;compile&#39;);</span>
  <span class="token keyword">const</span> Counter <span class="token operator">=</span> <span class="token keyword">await</span> hre<span class="token punctuation">.</span>ethers<span class="token punctuation">.</span><span class="token function">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">await</span> Counter<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> counter<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Counter deployed to:&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">saveFrontendFiles</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">saveFrontendFiles</span><span class="token punctuation">(</span><span class="token parameter">counter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> contractsDir <span class="token operator">=</span> <span class="token string">&quot;./data&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>contractsDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>contractsDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
    contractsDir <span class="token operator">+</span> <span class="token string">&quot;/contract-address.json&quot;</span><span class="token punctuation">,</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      Counter<span class="token operator">:</span> counter<span class="token punctuation">.</span>address
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> CounterArtifact <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">readArtifactSync</span><span class="token punctuation">(</span><span class="token string">&quot;Counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
    contractsDir <span class="token operator">+</span> <span class="token string">&quot;/Counter.json&quot;</span><span class="token punctuation">,</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>CounterArtifact<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//ç„¶åæ‰§è¡Œè„šæœ¬ npx hardhat run scripts/deploy_counter.js --network development</span>
</code></pre></div></li><li><p>æ–°å»ºaction.jså®ç°å‰ç«¯è°ƒç”¨åˆçº¦çš„é€»è¾‘</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  ethers
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hardhat&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> CounterArtifact <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../data/Counter.json&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> contractAddress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../data/contract-address.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// init</span>
  <span class="token keyword">const</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>JsonRpcProvider</span><span class="token punctuation">(</span><span class="token string">&#39;http://127.0.0.1:8545/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Then, we initialize the contract using that provider and the token&#39;s</span>
  <span class="token comment">// artifact. You can do this same thing with your contracts.</span>
  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>Contract</span><span class="token punctuation">(</span>
    contractAddress<span class="token punctuation">.</span>Counter<span class="token punctuation">,</span>
    CounterArtifact<span class="token punctuation">.</span>abi<span class="token punctuation">,</span>
    provider<span class="token punctuation">.</span><span class="token function">getSigner</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;counterå€¼æ˜¯ï¼š&quot;</span><span class="token punctuation">,</span><span class="token keyword">await</span> counter<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">await</span> counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;counterå€¼æ˜¯ï¼š&quot;</span><span class="token punctuation">,</span><span class="token keyword">await</span> counter<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ol></li></ol></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><!----><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]--></div></main></div><!----><!--]--><footer data-v-15d3260c> Powered by <a href="https://github.com/clark-cui/" target="_blank" title="ä½œè€…" data-v-15d3260c>clark-cui</a> | Copyright Â© 2019-2022 | MIT License </footer><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"c6f52484\",\"archives.md\":\"ca903f38\",\"index.md\":\"553c82f4\",\"posts_cosmosè¯¦è§£.md\":\"7d7e258f\",\"posts_defiç§‘æ™®.md\":\"fb339320\",\"posts_tts.md\":\"8e68bc4f\",\"posts_typescriptå­¦ä¹ ç¬”è®°.md\":\"fb48a741\",\"posts_buildsite.md\":\"ec9d9534\",\"posts_macå¤–æ¥æ˜¾ç¤ºå™¨.md\":\"8d5e6c2c\",\"posts_proxyconfig.md\":\"9fa059b1\",\"posts_åŒºå—é“¾ç§‘æ™®.md\":\"cca50001\",\"posts_åšå®¢å¼€å¯https.md\":\"a3bfdd96\",\"posts_å˜é‡æå‡.md\":\"b67a61c5\",\"posts_æ™ºèƒ½åˆçº¦å¼€å‘.md\":\"48e85489\",\"posts_çªç„¶æ—¥è®°ä¸€.md\":\"39f824b4\",\"posts_è™šæ‹Ÿæœºé…ç½®.md\":\"9f66f79e\",\"posts_éšä¾¿è¯´ç‚¹å•¥.md\":\"ffad966d\",\"tags.md\":\"43f8358c\"}")</script>
    <script type="module" async src="/assets/app.10064a06.js"></script>
    
  </body>
</html>